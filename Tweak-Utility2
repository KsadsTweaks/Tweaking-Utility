# Ksads Style Windows Tweak Utility with Clean UI

# Load necessary .NET assemblies
Add-Type -AssemblyName "System.Windows.Forms"
Add-Type -AssemblyName "System.Drawing"

# Check for Administrator Privileges
if (-not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    Write-Host "This script requires administrator privileges." -ForegroundColor Red
    Exit
}

# List of Tweaks
$tweaks = @(
    @{ Description = "Disable Telemetry"; Path = "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection"; Name = "AllowTelemetry"; Type = "DWORD"; Value = 0 },
    @{ Description = "Disable Diagnostic Tracking Services"; Path = "HKLM:\\SYSTEM\\CurrentControlSet\\Services\\DiagTrack"; Name = "Start"; Type = "DWORD"; Value = 4 },
    @{ Description = "Disable Feedback Requests"; Path = "HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\DataCollection"; Name = "DoNotShowFeedbackNotifications"; Type = "DWORD"; Value = 1 },
    @{ Description = "Disable Cortana"; Path = "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\Windows Search"; Name = "AllowCortana"; Type = "DWORD"; Value = 0 },
    @{ Description = "Disable Bing Search in Start Menu"; Path = "HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Search"; Name = "BingSearchEnabled"; Type = "DWORD"; Value = 0 },
    @{ Description = "Disable Advertising ID"; Path = "HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\AdvertisingInfo"; Name = "Enabled"; Type = "DWORD"; Value = 0 }
)

# Function to Apply a Registry Tweak
function Apply-Tweak {
    param (
        [string]$Path,
        [string]$Name,
        [string]$Type,
        [string]$Value
    )
    try {
        if (-not (Test-Path $Path)) {
            New-Item -Path $Path -Force | Out-Null
        }
        Set-ItemProperty -Path $Path -Name $Name -Value $Value -Type $Type
        Write-Host "Applied: $Path\$Name = $Value" -ForegroundColor Green
    } catch {
        Write-Host "Failed to apply: $Path\$Name" -ForegroundColor Red
    }
}

# Function to Apply Tweaks
function Apply-Tweaks {
    param (
        [array]$SelectedTweaks
    )
    foreach ($tweak in $SelectedTweaks) {
        Apply-Tweak -Path $tweak.Path -Name $tweak.Name -Type $tweak.Type -Value $tweak.Value
    }
}

# Create and Display UI Form
function Display-Menu {
    # Create the Form (window)
    $form = New-Object System.Windows.Forms.Form
    $form.Text = "Ksads Windows Tweaks"
    $form.Size = New-Object System.Drawing.Size(500, 400)
    $form.StartPosition = 'CenterScreen'
    $form.BackColor = [System.Drawing.Color]::FromArgb(33, 33, 33)  # Dark background

    # Create a Label for instructions
    $label = New-Object System.Windows.Forms.Label
    $label.Text = "Select Tweaks to Apply:"
    $label.ForeColor = [System.Drawing.Color]::White
    $label.Location = New-Object System.Drawing.Point(150, 20)
    $label.Size = New-Object System.Drawing.Size(200, 20)
    $form.Controls.Add($label)

    # Create checkboxes for each tweak
    $checkboxes = @()
    $yPosition = 60
    for ($i = 0; $i -lt $tweaks.Count; $i++) {
        $tweak = $tweaks[$i]
        $checkbox = New-Object System.Windows.Forms.CheckBox
        $checkbox.Text = $tweak.Description
        $checkbox.ForeColor = [System.Drawing.Color]::White
        $checkbox.BackColor = [System.Drawing.Color]::FromArgb(33, 33, 33)
        $checkbox.Location = New-Object System.Drawing.Point(50, $yPosition)
        $checkbox.Size = New-Object System.Drawing.Size(400, 20)
        $checkbox.Tag = $tweak
        $form.Controls.Add($checkbox)
        $checkboxes += $checkbox
        $yPosition += 30  # Adjust position for the next checkbox
    }

    # Create the 'Apply Tweaks' button
    $applyButton = New-Object System.Windows.Forms.Button
    $applyButton.Text = "Apply Selected Tweaks"
    $applyButton.Size = New-Object System.Drawing.Size(200, 40)
    $applyButton.Location = New-Object System.Drawing.Point(150, $yPosition)
    $applyButton.BackColor = [System.Drawing.Color]::FromArgb(66, 135, 245)  # Blue color
    $applyButton.ForeColor = [System.Drawing.Color]::White
    $form.Controls.Add($applyButton)

    # Action for 'Apply Tweaks' Button - apply selected tweaks
    $applyButton.Add_Click({
        $selectedTweaks = @()
        foreach ($checkbox in $checkboxes) {
            if ($checkbox.Checked) {
                $selectedTweaks += $checkbox.Tag
            }
        }
        
        if ($selectedTweaks.Count -gt 0) {
            Write-Host "===================================" -ForegroundColor Cyan
            Write-Host " Applying Selected Tweaks... " -ForegroundColor Yellow
            Write-Host "===================================" -ForegroundColor Cyan
            Apply-Tweaks -SelectedTweaks $selectedTweaks
            Write-Host "===================================" -ForegroundColor Cyan
            Write-Host " All tweaks have been applied!" -ForegroundColor Green
            Write-Host "===================================" -ForegroundColor Cyan
        } else {
            Write-Host "No tweaks selected." -ForegroundColor Red
        }
        $form.Close()  # Close the form after applying tweaks
    })

    # Show the form and wait for user input
    $form.ShowDialog()
}

# Run the Menu
Display-Menu
